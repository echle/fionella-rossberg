# Implementation Plan: Visual Asset Integration

**Branch**: `003-visual-assets` | **Date**: February 13, 2026 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/003-visual-assets/spec.md`

**Note**: This plan was generated by the `/speckit.plan` command. See `.specify/templates/commands/plan.md` for the execution workflow.

## Summary

This feature replaces placeholder graphics (brown circles, emoji icons) with professional sprite-based animations for the horse character, UI elements, particle effects, and environment backgrounds. The implementation uses Phaser 3's native sprite and animation systems with horizontal strip sprite sheets (128×128px frames). Animation states (idle, eating, grooming) are controlled via a simple enum-based state machine. The feature maintains full backward compatibility with existing game logic through graceful fallback to placeholder graphics if sprite assets fail to load. Total asset budget is <5MB with target load time under 3 seconds on standard broadband, maintaining 60 FPS performance throughout all animations.

## Technical Context

**Language/Version**: TypeScript 5.0.2 (strict mode enabled)  
**Primary Dependencies**: Phaser 3.80.0 (game engine), Zustand 4.5.0 (state management), Vite 5.0.0 (build tool)  
**Storage**: localStorage/IndexedDB for save data (browser-native, no external DB)  
**Testing**: Vitest 1.0.0 with @vitest/coverage-v8 for unit/integration tests  
**Target Platform**: Modern browsers (Chrome, Firefox, Safari, Edge latest 2 versions), WebGL with Canvas fallback
**Project Type**: Web game (single-page application)  
**Performance Goals**: 60 FPS during sprite animations and particle effects, <3s asset load on 5 Mbps connection  
**Constraints**: <5MB total asset size, <50MB memory increase with all sprites loaded, sprite animations at 12-24 FPS  
**Scale/Scope**: Single-scene game with 4 sprite animation states, 3 particle effects, layered background, resolution 320x240 to 2560x1440

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### Core Principles Alignment

**I. Visual Excellence First** ✅ PASS
- Feature directly implements visual excellence: replacing placeholder graphics with professional sprites
- All animations designed for smooth 60 FPS target
- Particle effects, visual feedback, and polished UI are core requirements
- Frame-based animations for smooth visual transitions

**II. Game Engine Foundation** ✅ PASS
- Built on Phaser 3.80.0 game engine
- Uses Phaser's sprite system, animation manager, scene architecture
- Leveraging Phaser's asset loader and texture atlas support
- No custom rendering - using proven engine APIs

**III. Browser-First Deployment** ✅ PASS
- Web-native implementation (no downloads required)
- PWA support via vite-plugin-pwa for offline play
- Responsive design: 320px-2560px width support (mobile to desktop)
- Cross-browser compatible (WebGL with Canvas fallback)
- Performance budget: <3s load on 5 Mbps, <5MB assets

**IV. Testable Game Logic** ✅ PASS
- Animation state transitions testable independently of rendering
- Asset loading/fallback logic unit testable
- Performance metrics measurable (FPS, load time, memory)
- Vitest configured for unit and integration tests

**V. 2D→3D Evolution Path** ✅ PASS
- Sprite-based architecture abstracts rendering from game logic
- Asset pipeline designed for sprite sheets (PNG) with metadata (JSON)
- Animation system uses state machine pattern - can adapt to 3D skeletal animation
- Entity system (Horse, StatusBar) separates visual representation from behavior

### Technical Standards Compliance

**Mandatory Stack** ✅ PASS
- Game Engine: Phaser 3.80.0 ✅
- Language: TypeScript 5.0.2 (strict mode) ✅
- Build Tool: Vite 5.0.0 ✅
- Testing: Vitest 1.0.0 with coverage ✅
- Version Control: Git with feature branch (003-visual-assets) ✅

**Code Quality** ✅ PASS
- ESLint + TypeScript rules configured ✅
- Prettier formatting configured ✅
- Type safety: strict mode enabled, no `any` without justification ✅

**Performance Standards** ✅ PASS
- FPS Target: 60 FPS (per spec) ✅
- Bundle Size: Asset budget <5MB meets <500KB JS bundle requirement ✅
- Load Time: <3s target aligned with <5s on 3G requirement ✅
- Memory: <50MB increase is well within <200MB heap requirement ✅

### Gate Status: ✅ ALL GATES PASSED

No constitutional violations. Feature aligns perfectly with all core principles and technical standards. Proceed to Phase 0 research.

---

### Post-Design Re-evaluation (After Phase 1)

**Re-evaluation Date**: February 13, 2026  
**Status**: ✅ ALL GATES STILL PASSING

**Design Verification**:
- ✅ Visual Excellence: Sprite-based animations with smooth 60 FPS transitions confirmed in research.md
- ✅ Game Engine Foundation: Full use of Phaser's AnimationManager, ParticleEmitter, and asset loading system per contracts/
- ✅ Browser-First: Asset optimization strategy (<5MB budget), progressive loading with fallbacks per quickstart.md
- ✅ Testable Logic: Backward compatibility maintained, game logic unchanged, animation state testable per data-model.md
- ✅ 2D→3D Evolution: Animation state machine pattern supports future skeletal animation migration

**Complexity Check**: No new violations introduced. Sprite integration is additive and non-breaking.

**Conclusion**: Design is constitution-compliant. Ready for Phase 2 (task generation).

## Project Structure

### Documentation (this feature)

```text
specs/[###-feature]/
├── plan.md              # This file (/speckit.plan command output)
├── research.md          # Phase 0 output (/speckit.plan command)
├── data-model.md        # Phase 1 output (/speckit.plan command)
├── quickstart.md        # Phase 1 output (/speckit.plan command)
├── contracts/           # Phase 1 output (/speckit.plan command)
└── tasks.md             # Phase 2 output (/speckit.tasks command - NOT created by /speckit.plan)
```

### Source Code (repository root)

```text
assets/
├── sprites/              # Character sprite sheets (horse animations)
│   ├── horse/           # Horse sprite assets with metadata (horse_idle.png, horse_eat.png, etc. - 512×384 frames)
│   └── girl/            # Player character assets
├── icons/               # UI element sprites (carrots, brushes, buttons) [Deferred to US2]
├── particles/           # Particle effect sprites (hearts, sparkles) [Deferred to US3]
└── backgrounds/         # Environment background layers [Deferred to US4, will be created when implementing]

src/
├── scenes/              # Phaser scene management
│   ├── BootScene.ts    # Asset preloading scene
│   ├── MainGameScene.ts # Primary game scene with sprite rendering
│   └── UIScene.ts      # UI overlay scene
├── entities/           # Game entity classes
│   ├── Horse.ts       # Horse character with animation state machine
│   ├── StatusBar.ts   # UI bar components
│   └── InventoryItem.ts
├── systems/           # Game logic systems
│   ├── InputSystem.ts
│   ├── DecaySystem.ts
│   └── SaveSystem.ts
├── config/           # Configuration files
│   ├── phaserConfig.ts    # Phaser engine configuration
│   └── gameConstants.ts   # Game constants and animation configs
├── state/            # State management (Zustand)
│   ├── gameStore.ts
│   ├── actions.ts
│   └── types.ts
└── utils/           # Helper utilities
    ├── mathUtils.ts
    ├── timeUtils.ts
    └── feedingHelpers.ts

tests/
├── unit/            # Unit tests for game logic
└── integration/     # Multi-system integration tests
```

**Structure Decision**: Single project structure (web game). Assets organized by type (sprites, icons, particles, backgrounds) with descriptive subfolders. Source code follows Phaser best practices with scene-based architecture. Game logic (systems/, state/) is separated from rendering (scenes/, entities/) for testability.

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| [e.g., 4th project] | [current need] | [why 3 projects insufficient] |
| [e.g., Repository pattern] | [specific problem] | [why direct DB access insufficient] |
